{% load elements %}

<div id="become_observer_dialog">
    <div id="grakon_tab">
        <b>Если вы уже записались в наблюдатели</b>, выберите соответствущую организацию/партию/кандидата:

        <div class="center">
            <form id="become_observer_form" method="post" action="{% url become_observer %}">
                {% csrf_token %}
                <select name="organization">
                    {% for organization in organizations %}
                        {% if organization.signup_observers and organization.verified %}
                            <option value="{{ organization.name }}">{{ organization.title }}</option>
                        {% endif %}
                    {% endfor %}
                    <option value="">Другая организация</option>
                </select>
                <div id="other_observer_organization">
                    <br/>
                    <input type="text" name="data" value="" size="50" maxlength="50" />
                </div>
                <input type="hidden" name="tik" value="{{ current_location.id }}" />
            </form>
        </div>

        После нажатия кнопки "Записаться", вы появитесь в списке наблюдателей, однако этот статус
        не будет являться подтвержденным. В ближайшее время мы введем возможность верифицировать этот статус.
    </div>
</div>

<script type="text/javascript">
    var signup_button = {
        text: "Записаться",
        click: function signup(){
            signup_for_role("observer", "{{ request.path }}");
        }
    };

    var cancel_button = {text: "Отмена", click: function(){
        $("#become_observer_dialog").dialog("close");
    }};

    function become_observer_dialog_init(){
        $("#become_observer_dialog").dialog("open");

        $("#grakon_btn").click(function(){
            $("#become_observer_dialog").dialog("option", "buttons",
                    [signup_button, cancel_button]);
        });
        $("#partner_btn").click(function(){
            $("#become_observer_dialog").dialog("option", "buttons", [cancel_button]);
        });
    }

    $("#become_observer_dialog").dialog({width:650, height:450, modal: true,
            title: "Записаться в наблюдатели", buttons: [signup_button, cancel_button]
    }).dialog("close");

    function sync_observer_organization_input(){
        if ($("#become_observer_form select").val()=="")
            $("#other_observer_organization").show();
        else
            $("#other_observer_organization").hide();
    }

    $("#become_observer_form select").change(sync_observer_organization_input);
    sync_observer_organization_input();
</script>
